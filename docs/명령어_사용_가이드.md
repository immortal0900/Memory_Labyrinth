# Main Features 명령어 사용 가이드

## 개요

Cursor의 User Command 기능을 활용하여 프로젝트의 핵심 기술을 자동으로 문서화하는 명령어입니다.

## 명령어 목록

| 명령어 | 용도 | 사용 예시 |
|--------|------|-----------|
| `/Main features` | 초기 문서 생성 | `/Main features npc` |
| `/Main features-sync` | 기존 문서 업데이트 | `/Main features-sync 하이브리드검색` |

## 설치 확인

### 1. 명령어 파일 확인

다음 위치에 명령어 파일이 있는지 확인하세요:

**Windows:**
```
C:\Users\[사용자명]\.cursor\commands\
├── Main-features.md
└── Main-features-sync.md
```

**Mac/Linux:**
```
~/.cursor/commands/
├── Main-features.md
└── Main-features-sync.md
```

### 2. Cursor에서 명령어 인식 확인

1. Cursor의 채팅 입력창에서 `/` 입력
2. 드롭다운 메뉴에서 "Main features" 와 "Main features-sync" 확인

![명령어 드롭다운 예시](https://cursor.com/docs-static/images/chat/commands/input.png)

## 사용 방법

### 초기 문서 생성: `/Main features`

프로젝트에서 처음으로 핵심 기술을 정리할 때 사용합니다.

**사용법:**
```
/Main features [키워드]
```

**예시:**

1. **NPC 시스템 전체 정리**
   ```
   /Main features npc
   ```
   → NPC 관련 모든 핵심 기술을 탐색하여 문서 생성

2. **메모리 시스템만 정리**
   ```
   /Main features memory
   ```
   → 메모리 시스템 관련 핵심 기술만 문서화

3. **프로젝트 전체 정리**
   ```
   /Main features all
   ```
   → 프로젝트의 모든 차별화된 기술 문서화

**워크플로 (개선):**

1. **프로젝트 탐색**: 키워드 관련 핵심 기술 식별
2. **탐색 결과 제시**: 발견한 기술 목록과 간단한 설명
3. **사용자 확인 요청**: "이렇게 진행해도 될까요?"
4. **사용자 응답에 따라**:
   - **"진행해"**: 문서 생성 실행
   - **수정 요청**: 1단계(탐색)로 돌아가서 재탐색
   - **거부/중단**: 작업 종료

**결과:**
- `docs/핵심기술.md` 파일 생성
- YAML frontmatter 포함 (생성날짜, 태그 등)
- 각 기술별 섹션 (선택 이유, 구현 방법, 핵심 기능)
- 요약 테이블

**주의사항:**
- `docs/핵심기술.md` 파일이 이미 존재하면 경고 출력
- 기존 문서가 있을 때는 `/Main features-sync` 사용 권장
- **사용자 승인 없이 문서를 생성하지 않음**

---

### 문서 업데이트: `/Main features-sync`

기존 문서에 새로운 기술을 추가하거나 기존 섹션을 업데이트할 때 사용합니다.

**사용법:**
```
/Main features-sync [기능명]
```

**예시:**

1. **기존 기능 업데이트**
   ```
   /Main features-sync 하이브리드검색
   ```
   → "하이브리드 검색" 섹션을 찾아 최신 코드로 업데이트

2. **새 기능 추가**
   ```
   /Main features-sync 의도분류
   ```
   → 문서에 "의도 분류" 섹션이 없으면 새로 추가

3. **NPC-NPC 대화 시스템 추가**
   ```
   /Main features-sync NPC-NPC 인터럽트
   ```
   → 새로운 핵심 기능을 문서에 추가

**워크플로 (개선):**

1. **기존 문서 읽기**: `docs/핵심기술.md` 확인
2. **프로젝트 탐색**: 해당 기능의 최신 구현 상태 파악
3. **변경사항 정리**: 업데이트/추가할 내용 요약
4. **사용자 확인 요청**: "이렇게 수정해도 될까요?"
5. **사용자 응답에 따라**:
   - **"진행해"**: 문서 업데이트 실행
   - **수정 요청**: 2단계(탐색)로 돌아가서 재탐색
   - **거부/중단**: 작업 종료

**결과:**
- 지정된 섹션만 업데이트 (전체 문서는 유지)
- 마지막수정날짜 자동 갱신
- 요약 테이블 자동 동기화
- 섹션 번호 자동 재정렬

**주의사항:**
- `docs/핵심기술.md` 파일이 없으면 에러 출력
- 초기 생성은 `/Main features` 사용 필요
- **사용자 승인 없이 문서를 수정하지 않음**

---

## 생성되는 문서 구조

```markdown
---
생성날짜: 2026-01-25 06:30
마지막수정날짜: 2026-01-25-토요일 06:30
tags:
- 핵심기술
- 포트폴리오
type:
- 기술문서
---

# NPC 핵심 기술 정리

---

## 1. 장기 메모리 시스템

### 선택 이유
| 기존 방식의 한계 | 해결 필요성 |
|-----------------|------------|
| Mem0 메타데이터 부재 | 화자/대상 구분 필요 |

### 구현 방법
- **구현 파일**: `src/db/user_memory_manager.py`
- **핵심 로직**: Fact 단위 저장, SPO 형태
- **참고 문서**: [pgvector](https://github.com/pgvector/pgvector)

### 핵심 기능
- 대화에서 Fact 선별 추출
- 화자/대상 명확히 구분
- 취향 변화 시 기억 무효화

---

## 요약 테이블

| 기술/기능 | 선택 이유 | 구현 방법 | 핵심 기능 |
|----------|----------|----------|----------|
| **장기 메모리** | Mem0 한계 | Fact 저장+메타데이터 | 화자구분, 취향추적 |
```

## 스마트 탐색 전략

명령어는 프로젝트를 **자동으로 분석**하여 최적의 탐색 경로를 선택합니다.

### 프로젝트 타입 자동 감지

| 감지 파일 | 프로젝트 타입 | 주요 탐색 경로 |
|----------|-------------|---------------|
| `package.json` | JavaScript/TypeScript | `src/`, `lib/`, `components/`, `pages/` |
| `requirements.txt`, `pyproject.toml` | Python | `src/`, `app/`, `core/`, `services/` |
| `go.mod` | Go | `cmd/`, `internal/`, `pkg/` |
| `pom.xml`, `build.gradle` | Java | `src/main/java/` |
| `Cargo.toml` | Rust | `src/`, `crates/` |

### 계층적 탐색 우선순위

1. **키워드 기반 검색** (가장 정확)
   - 파일명, 클래스명, 함수명에서 검색
   - Import/의존성 추적

2. **Git 히스토리** (Main-features-sync만)
   - 최근 변경 파일 (7일 이내)
   - 가장 많이 수정된 파일

3. **문서 기반 힌트**
   - README.md, docs/ 내 구조 정보
   - .cursor/plans/ 내 설계 문서

4. **프로젝트 타입별 표준 경로** (폴백)

**차별점 판단 기준:**
- 기존 라이브러리를 그대로 사용하지 않고 **커스텀 구현**
- 성능/정확도를 위한 **독자적 알고리즘**
- 도메인 특화 **최적화**

## 문서 작성 원칙

명령어가 문서를 작성할 때 따르는 원칙:

1. **초보자 관점**: 코드 없이도 핵심 아이디어 이해 가능
2. **검증 가능성**: 모든 기술에 실제 구현 파일 경로 포함
3. **출처 명시**: 외부 기술은 공식 문서 링크 필수
4. **차별성 강조**: 일반적인 구현과 다른 점 부각
5. **구체성**: "최적화", "개선" 대신 구체적 수치/방법 명시

## 사용자 확인 예시

### 예시 1: 탐색 결과 확인 (/Main features)

```
사용자: /Main features npc

AI:
## 탐색 완료

다음 핵심 기술들을 발견했습니다:

1. **장기 메모리 시스템** - Mem0 대체 자체 구현
   - 구현 파일: `src/db/user_memory_manager.py`
   
2. **하이브리드 검색** - pgvector + PGroonga 4요소 스코어링
   - 구현 파일: `src/db/user_memory_schema.sql`

3. **의도 분류** - LLM 기반 최근 3턴 컨텍스트 활용
   - 구현 파일: `src/agents/npc/heroine_agent.py`

이렇게 진행해도 될까요?

사용자: 의도 분류는 빼고 진행해

AI: (프로젝트 재탐색 → 의도 분류 제외한 결과 다시 제시)
```

### 예시 2: 수정 요청 (/Main features-sync)

```
사용자: /Main features-sync 하이브리드검색

AI:
## 업데이트 내용 확인

"하이브리드 검색" 섹션을 다음과 같이 수정합니다:

### 변경사항:
- 가중치 변경: Recency 0.1 → 0.15, Importance 0.1 → 0.15
- 새 기능 추가: memory_progress 기반 필터링

이렇게 수정해도 될까요?

사용자: 참고 문서 링크도 추가해줘

AI: (프로젝트 재탐색 → 참고 문서 링크 포함하여 다시 제시)
```

## 테스트 시나리오

### 테스트 1: 초기 문서 생성 + 수정 요청

```
1. Cursor 채팅에서 입력: /Main features npc
2. 탐색 결과 확인 메시지 대기
3. 수정 요청: "NPC-NPC는 제외해줘"
4. 재탐색 후 수정된 결과 확인
5. "진행해" 응답
6. docs/핵심기술.md 파일 생성 확인
7. 파일 내용 검토:
   - YAML frontmatter 존재
   - NPC-NPC 섹션 제외됨
   - 구현 파일 경로 포함
   - 공식 문서 링크 포함
```

### 테스트 2: 기존 문서 업데이트 + 승인

```
1. Cursor 채팅에서 입력: /Main features-sync 하이브리드검색
2. 변경사항 확인 메시지 대기
3. "진행해" 응답
4. 업데이트 완료 메시지 확인
5. 파일 내용 검토:
   - 마지막수정날짜 갱신
   - 요약 테이블 동기화
   - 다른 섹션은 그대로 유지
```

### 테스트 3: 새 기능 추가 + 중단

```
1. Cursor 채팅에서 입력: /Main features-sync 새기능명
2. 새 섹션 추가 확인 메시지 대기
3. "중단" 응답
4. 작업 중단 확인
5. 파일이 수정되지 않았는지 확인
```

## 트러블슈팅

### 명령어가 보이지 않음

**원인:** Cursor가 명령어 파일을 인식하지 못함

**해결:**
1. Cursor 재시작
2. 명령어 파일 위치 확인 (`~/.cursor/commands/`)
3. 파일 확장자가 `.md`인지 확인

### 문서가 생성되지 않음

**원인:** docs 폴더가 없거나 권한 문제

**해결:**
```powershell
# docs 폴더 생성
New-Item -ItemType Directory -Force -Path "docs"
```

### 기존 문서 덮어쓰기 경고

**원인:** `/Main features` 실행 시 이미 문서 존재

**해결:**
- `/Main features-sync [기능명]` 사용하여 업데이트

## 참고 자료

- [Cursor Commands 공식 문서](https://cursor.com/ko/docs/context/commands)
- [프로젝트 가이드라인](../CLAUDE.md)
- [명령어 설계 Plan](../.cursor/plans/main_features_command_*.plan.md)
