# ğŸ° Dungeon API ëª…ì„¸ì„œ

**Base URL**: `http://127.0.0.1:8090/api/dungeon`

ì´ ë¬¸ì„œëŠ” ì–¸ë¦¬ì–¼ ì—”ì§„(Client)ê³¼ AI ì„œë²„(Server) ê°„ì˜ ë˜ì „ ì‹œìŠ¤í…œ í†µì‹  í”„ë¡œí† ì½œì„ ì •ì˜í•©ë‹ˆë‹¤.

---

## ğŸ”„ ì „ì²´ íë¦„ (Workflow)

1.  **ë˜ì „ ì…ì¥ (Entrance)**:
    *   í´ë¼ì´ì–¸íŠ¸ê°€ 1ì¸µ ë§µ ì •ë³´ë¥¼ ìƒì„±í•˜ì—¬ ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
    *   ì„œë²„ëŠ” 1, 2, 3ì¸µ ë°ì´í„°ë¥¼ DBì— ìƒì„±í•˜ê³ , 1ì¸µì— ë°°ì¹˜ë  **ì´ë²¤íŠ¸**ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
2.  **í”Œë ˆì´ ì§„í–‰**:
    *   í”Œë ˆì´ì–´ëŠ” 1ì¸µì„ íƒí—˜í•˜ë©° ëª¬ìŠ¤í„°ì™€ ì „íˆ¬í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
3.  **ë³´ìŠ¤ë°© ì§„ì… (Balance)**:
    *   1ì¸µ ë³´ìŠ¤ë°©ì— ì…ì¥í•˜ëŠ” ì‹œì ì— ì„œë²„ë¡œ ë°¸ëŸ°ì‹± ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
    *   ì„œë²„ëŠ” í”Œë ˆì´ì–´ë“¤ì˜ ìƒíƒœ(ì²´ë ¥, ê¸°ì–µ ë“±)ë¥¼ ë¶„ì„í•˜ì—¬ **2ì¸µ(ë‹¤ìŒ ì¸µ)**ì˜ ë§µ êµ¬ì¡°ë¥¼ ë°¸ëŸ°ì‹±í•˜ê³ , 2ì¸µì—ì„œ ë°œìƒí•  ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    *   ì„œë²„ëŠ” **2ì¸µì˜ ëª¬ìŠ¤í„° ë°°ì¹˜ ì •ë³´**ì™€ **ì´ë²¤íŠ¸ ì •ë³´**ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
4.  **ì¸µ ì™„ë£Œ (Clear)**:
    *   í•´ë‹¹ ì¸µì„ ì™„ì „íˆ í´ë¦¬ì–´í–ˆìŒì„ ì„œë²„ì— ì•Œë¦½ë‹ˆë‹¤.
5.  **ë‹¤ìŒ ì¸µ ì´ë™**:
    *   í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ì—ì„œ ë°›ì€ 2ì¸µ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ 2ì¸µì„ ë¡œë“œí•©ë‹ˆë‹¤. (ë°˜ë³µ)

---

## 1. ë˜ì „ ì…ì¥ (Entrance)

í”Œë ˆì´ì–´ íŒŒí‹°ê°€ ë˜ì „ì— ì²˜ìŒ ì…ì¥í•  ë•Œ í˜¸ì¶œí•©ë‹ˆë‹¤.

*   **URL**: `/entrance`
*   **Method**: `POST`
*   **ì„¤ëª…**:
    *   í´ë¼ì´ì–¸íŠ¸(Unreal)ì—ì„œ ì ˆì°¨ì ìœ¼ë¡œ ìƒì„±í•œ 1ì¸µì˜ `rawMap` ë°ì´í„°ë¥¼ ë°›ìŠµë‹ˆë‹¤.
    *   ì„œë²„ëŠ” ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ 1ì¸µ, 2ì¸µ, 3ì¸µì˜ DB ë ˆì½”ë“œë¥¼ ë¯¸ë¦¬ ìƒì„±í•©ë‹ˆë‹¤.
    *   íˆë¡œì¸ì˜ ìƒíƒœ(`heroineData`)ë¥¼ ë¶„ì„í•˜ì—¬ 1ì¸µì— ì í•©í•œ **ì´ˆê¸° ì´ë²¤íŠ¸**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### ìš”ì²­ (Request)

| í•„ë“œëª… | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
| :--- | :--- | :--- | :--- |
| `rawMap` | Object | Yes | ì–¸ë¦¬ì–¼ì—ì„œ ìƒì„±í•œ ë§µ êµ¬ì¡° ë°ì´í„° |
| `heroineData` | Object | Yes | ë©”ì¸ íˆë¡œì¸ì˜ í˜„ì¬ ìƒíƒœ ë° ìŠ¤íƒ¯ ì •ë³´ |
| `usedEvents` | Array | No | ì´ì „ì— ì‚¬ìš©ëœ ì´ë²¤íŠ¸ ID ëª©ë¡ (ì¤‘ë³µ ë°©ì§€ìš©) |

```json
{
  "rawMap": {
    "playerIds": [101, 102],
    "heroineIds": [1, 2],
    "rooms": [
      {
        "roomId": 0,
        "type": 0,  // 0:Empty, 1:Monster, 2:Event, 3:Treasure, 4:Boss
        "size": 1,
        "neighbors": [1],
        "monsters": [],
        "eventType": 0
      },
      {
        "roomId": 1,
        "type": 1,
        "size": 1,
        "neighbors": [0, 2],
        "monsters": [
          { "monsterId": 101, "posX": 100.0, "posY": 200.0 }
        ],
        "eventType": 0
      },
      {
        "roomId": 2,
        "type": 4,
        "size": 1,
        "neighbors": [1],
        "monsters": [],
        "eventType": 0
      }
    ],
    "rewards": []
  },
  "heroineData": {
    "playerId": 101,
    "heroineId": 1,
    "memoryProgress": 0,
    "heroineStat": {
      "hp": 100, "atk": 10, "def": 5, "spd": 10,
      "strength": 10, "dexterity": 10, "intelligence": 10
    },
    "heroineMemories": [10, 50], // í•´ê¸ˆëœ ê¸°ì–µ ID ë¦¬ìŠ¤íŠ¸
    "dungeonPlayerData": { "level": 1, "exp": 0 }
  },
  "usedEvents": []
}
```

### ì‘ë‹µ (Response)

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… |
| :--- | :--- | :--- |
| `success` | Boolean | ìš”ì²­ ì„±ê³µ ì—¬ë¶€ |
| `firstPlayerId` | Integer | ë°©ì¥ ID (ì„¸ì…˜ ì‹ë³„ì) |
| `events` | Array | 1ì¸µì— ë°°ì¹˜ë  ì´ë²¤íŠ¸ ëª©ë¡ |

```json
{
    "success": true,
    "message": "ë˜ì „ ì…ì¥ ì„±ê³µ",
    "firstPlayerId": 101,
    "events": [
        {
            "roomId": 2,
            "eventType": 0,
            "eventTitle": "ìƒì„±ëœ ì´ë²¤íŠ¸ ì œëª©",
            "eventCode": "EVENT_CODE",
            "scenarioText": "ì´ë²¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ í…ìŠ¤íŠ¸ (í™”ë©´ í‘œì‹œìš©)",
            "scenarioNarrative": "ì´ë²¤íŠ¸ ë‚´ëŸ¬í‹°ë¸Œ (AI ì²˜ë¦¬ìš©)"
        }
    ]
}
```

---

## 2. ë°¸ëŸ°ì‹± & ë‹¤ìŒ ì¸µ ìƒì„± (Balance)

í˜„ì¬ ì¸µì˜ ë³´ìŠ¤ë°©ì— ì…ì¥í•˜ê±°ë‚˜ í´ë¦¬ì–´í–ˆì„ ë•Œ í˜¸ì¶œí•©ë‹ˆë‹¤. **ë‹¤ìŒ ì¸µ(Next Floor)**ì„ ì¤€ë¹„í•˜ëŠ” í•µì‹¬ ë‹¨ê³„ì…ë‹ˆë‹¤.

*   **URL**: `/balance`
*   **Method**: `POST`
*   **ì„¤ëª…**:
    *   í”Œë ˆì´ì–´ë“¤ì˜ í˜„ì¬ ìƒíƒœ(`playerDataList`)ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
    *   AI ì—ì´ì „íŠ¸ê°€ **ë‹¤ìŒ ì¸µ**ì˜ ë‚œì´ë„ë¥¼ ì¡°ì ˆí•˜ê³ , ëª¬ìŠ¤í„°ë¥¼ ë°°ì¹˜(`monsterPlacements`)í•©ë‹ˆë‹¤.
    *   íˆë¡œì¸ì˜ ê¸°ì–µê³¼ ìƒíƒœì— ë§ì¶° **ë‹¤ìŒ ì¸µì˜ ì´ë²¤íŠ¸**(`nextFloorEvent`)ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    *   ì´ ì •ë³´ë“¤ì€ DBì˜ ë‹¤ìŒ ì¸µ ë ˆì½”ë“œì— ì €ì¥ë©ë‹ˆë‹¤.

### ìš”ì²­ (Request)

| í•„ë“œëª… | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
| :--- | :--- | :--- | :--- |
| `firstPlayerId` | Integer | Yes | ë°©ì¥ ID |
| `playerDataList` | Array | Yes | íŒŒí‹°ì› ì „ì²´ì˜ ìƒíƒœ ì •ë³´ ë¦¬ìŠ¤íŠ¸ |
| `usedEvents` | Array | No | ì‚¬ìš©ëœ ì´ë²¤íŠ¸ ëª©ë¡ |

```json
{
  "firstPlayerId": 101,
  "playerDataList": [
    {
      "heroineData": {
        "playerId": 101,
        "heroineId": 1,
        "memoryProgress": 0,
        "heroineStat": {
          "hp": 95, "atk": 12, "def": 6, "spd": 11,
          "strength": 12, "dexterity": 11, "intelligence": 10
        },
        "heroineMemories": [10, 50],
        "dungeonPlayerData": { "level": 1, "exp": 100 }
      }
    },
    {
      "heroineData": {
        "playerId": 102,
        "heroineId": 2,
        "memoryProgress": 0,
        "heroineStat": {
          "hp": 90, "atk": 15, "def": 4, "spd": 12,
          "strength": 14, "dexterity": 12, "intelligence": 8
        },
        "heroineMemories": [],
        "dungeonPlayerData": { "level": 1, "exp": 100 }
      }
    }
  ],
  "usedEvents": []
}
```

### ì‘ë‹µ (Response)

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… |
| :--- | :--- | :--- |
| `monsterPlacements` | Array | **ë‹¤ìŒ ì¸µ**ì˜ ë°©ë³„ ëª¬ìŠ¤í„° ë°°ì¹˜ ì •ë³´ |
| `nextFloorEvent` | Object | **ë‹¤ìŒ ì¸µ**ì—ì„œ ë°œìƒí•  ë©”ì¸ ì´ë²¤íŠ¸ ì •ë³´ |
| `agentResult` | Object | (ë””ë²„ê¹…ìš©) AI ì—ì´ì „íŠ¸ì˜ ë¶„ì„ ê²°ê³¼ |

```json
{
    "success": true,
    "message": "ë˜ì „ ë°¸ëŸ°ì‹± ì„±ê³µ",
    "firstPlayerId": 101,
    "monsterPlacements": [
        { "roomId": 1, "monsterId": 102, "count": 3 },
        { "roomId": 3, "monsterId": 201, "count": 1 }
    ],
    "nextFloorEvent": {
        "roomId": 2,
        "eventType": 0,
        "eventTitle": "ë‹¤ìŒ ì¸µ ì´ë²¤íŠ¸ ì œëª©",
        "eventCode": "NEXT_EVENT_CODE",
        "scenarioText": "ë‹¤ìŒ ì¸µ ì‹œë‚˜ë¦¬ì˜¤...",
        "scenarioNarrative": "ë‹¤ìŒ ì¸µ ë‚´ëŸ¬í‹°ë¸Œ..."
    },
    "agentResult": { ... }
}
```

---

## 3. ì¸µ ì™„ë£Œ (Clear)

í˜„ì¬ ì¸µì˜ ëª¨ë“  ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê³  ë‹¤ìŒ ì¸µìœ¼ë¡œ ì´ë™í•˜ê¸° ì§ì „ì— í˜¸ì¶œí•©ë‹ˆë‹¤.

*   **URL**: `/clear`
*   **Method**: `PUT`
*   **ì„¤ëª…**:
    *   ì„œë²„ DBì—ì„œ í˜„ì¬ ì¸µì˜ ìƒíƒœë¥¼ 'ì™„ë£Œ(Finished)'ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
    *   ì´í›„ í´ë¼ì´ì–¸íŠ¸ëŠ” `/balance`ì—ì„œ ë°›ì€ ì •ë³´ë¥¼ í† ëŒ€ë¡œ ë‹¤ìŒ ì¸µì„ ë¡œë“œí•©ë‹ˆë‹¤.

### ìš”ì²­ (Request)

```json
{
  "playerIds": [101, 102]
}
```

### ì‘ë‹µ (Response)

```json
{
    "success": true,
    "message": "1ì¸µ ì™„ë£Œ",
    "finishedFloor": 1
}
```

---

## 4. ì´ë²¤íŠ¸ ì„ íƒ (Event Select)

í”Œë ˆì´ì–´ê°€ ë˜ì „ ë‚´ ì´ë²¤íŠ¸ ë°©ì—ì„œ ì„ íƒì§€(Choice)ë¥¼ ê³¨ëì„ ë•Œ í˜¸ì¶œí•©ë‹ˆë‹¤.

*   **URL**: `/event/select`
*   **Method**: `POST`
*   **ì„¤ëª…**:
    *   í”Œë ˆì´ì–´ì˜ ì„ íƒì„ ì„œë²„ì— ê¸°ë¡í•˜ê³ , ê·¸ì— ë”°ë¥¸ ê²°ê³¼(ë³´ìƒ, íŒ¨ë„í‹°, ë‚´ëŸ¬í‹°ë¸Œ ë³€í™” ë“±)ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

### ìš”ì²­ (Request)

| í•„ë“œëª… | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
| :--- | :--- | :--- | :--- |
| `firstPlayerId` | Integer | Yes | ë°©ì¥ ID |
| `selectingPlayerId` | Integer | Yes | ì„ íƒí•œ í”Œë ˆì´ì–´ ID |
| `roomId` | Integer | Yes | ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ë°© ë²ˆí˜¸ |
| `choice` | String | Yes | ì„ íƒí•œ ì„ íƒì§€ì˜ í…ìŠ¤íŠ¸ ë‚´ìš© |

```json
{
  "firstPlayerId": 101,
  "selectingPlayerId": 101,
  "roomId": 2,
  "choice": "í‘œì§€íŒì— ì íŒ ë‚´ìš©ì„ ëê¹Œì§€ ê¼¼ê¼¼íˆ ì½ì–´ ì¡°ê±´ì„ ì •í™•íˆ íŒŒì•…í•œë‹¤"
}
```

### ì‘ë‹µ (Response)

```json
{
    "success": true,
    "firstPlayerId": 101,
    "selectingPlayerId": 101,
    "roomId": 2,
    "outcome": "ë‹¹ì‹ ì€ '...'ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤. ë³´ìƒì€ ..."
}
```
