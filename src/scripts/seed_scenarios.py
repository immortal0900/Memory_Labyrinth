"""
시나리오 데이터 임베딩 및 DB 삽입 스크립트 (metadata 포함)

사용법:
    python src/scripts/seed_scenarios.py
참고:
    - heroine_scenario_database.md
    - sage_scenarios_detailed_v1.md
변경사항:
    - metadata 컬럼 추가 (JSONB)
    - keywords 배열로 검색 최적화
    - 임베딩 = content + keywords 결합
"""

import os
import sys
import json
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent.parent.parent))
sys.path.insert(0, str(Path(__file__).parent.parent))

from sqlalchemy import create_engine, text
from langchain_openai import OpenAIEmbeddings
from dotenv import load_dotenv

load_dotenv()

from db.config import CONNECTION_URL


# =============================================================================
# 히로인 시나리오 데이터
# =============================================================================

HEROINE_SCENARIOS = [
    # =========================================================================
    # 레티아 (heroine_id=1)
    # =========================================================================
    {
        "heroine_id": 1,
        "memory_progress": 10,
        "title": "레티아 회상 1: 귀족의 어린 시절",
        "metadata": {
            "keywords": [
                "고향", "출신", "어디서 왔", "태어난 곳", "자란 곳",
                "세일럼", "아캄", "왕국", "수도",
                "귀족", "가문", "루크", "루크 가문", "집안", "가족",
                "아버지", "어머니", "부모", "로렌스", "엘레나",
                "어린 시절", "어렸을 때", "과거", "옛날", "7살", "7세",
                "검술", "훈련", "교육", "학문", "예절",
                "억압", "고독", "외로움", "인정",
                "브로치", "저택", "대리석"
            ]
        },
        "content": """[회상 1: 귀족의 어린 시절]

■ 육하원칙
- 누가: 레티아 루크(당시 7세)가
- 언제: 창세기 약 14년 전, 레티아가 어린 시절이었을 때
- 어디서: 세일럼 왕국 수도 아캄의 루크 가문 저택에서
- 무엇을: 귀족 가문의 장녀로서 검술, 학문, 예절 등 다방면의 교육을 받으며 성장했다
- 어떻게: 매일 새벽부터 밤늦게까지 가문의 명예를 위한 혹독한 훈련을 받았으며, 실수가 허용되지 않는 환경에서 완벽함을 강요받았다
- 왜: 루크 가문은 세일럼 왕국의 5대 귀족 가문 중 하나로, 가문의 후계자에게 흠잡을 데 없는 능력을 요구했기 때문이다

■ 핵심 기억 요소
- 장소: 루크 가문 저택의 훈련실, 서재, 대연회장
- 인물: 엄격한 아버지 로렌스 루크, 냉담한 어머니 엘레나 루크
- 감정: 억압, 고독, 인정받고 싶은 갈망
- 상징물: 루크 가문의 문장이 새겨진 은색 브로치

■ NPC 응답 가이드
- 이 기억이 해금되면 레티아는 자신이 귀족 출신임을 인정할 수 있다
- 예시 대사: "어렴풋이... 큰 저택에서 살았던 것 같아요. 차가운 대리석 바닥과... 끝없는 복도가 기억나요."
- 트라우마 키워드(귀족, 세일럼) 언급 시 약간의 불안 반응"""
    },
    {
        "heroine_id": 1,
        "memory_progress": 50,
        "title": "레티아 회상 2: 속박된 아이돌",
        "metadata": {
            "keywords": [
                "학교", "학원", "왕립학원", "학창시절", "학생", "15살", "15세",
                "아이돌", "인기", "완벽", "문무겸비", "칭송",
                "친구", "친구 있", "외로", "고독", "혼자",
                "가면", "진짜 나", "속박", "자유", "감시",
                "가문", "루크", "체면", "스캔들",
                "교복", "휘장", "도서관", "검술"
            ]
        },
        "content": """[회상 2: 속박된 아이돌]

■ 육하원칙
- 누가: 레티아 루크(당시 15세)가
- 언제: 창세기 약 6년 전, 세일럼 왕립학원 재학 시절
- 어디서: 세일럼 왕국 아캄에 위치한 왕립학원에서
- 무엇을: 문무겸비의 완벽한 학생으로 칭송받으며 학원의 아이돌로 인기를 얻었으나, 내면으로는 극심한 고독감과 속박감을 느꼈다
- 어떻게: 항상 완벽한 미소를 유지해야 했고, 모든 행동이 감시당했으며, 진정한 친구 하나 사귀지 못한 채 가면을 쓰고 살았다
- 왜: 루크 가문의 체면을 위해 어떤 스캔들도 허용되지 않았고, 레티아의 모든 인간관계는 가문에 의해 통제되었기 때문이다

■ 핵심 기억 요소
- 장소: 왕립학원 교정, 도서관, 검술 훈련장
- 인물: 표면적인 친구들, 레티아를 감시하는 가문의 하인들
- 감정: 외로움, 자유에 대한 갈망, 가면 뒤의 진짜 나
- 상징물: 항상 착용해야 했던 학원 교복의 루크 가문 휘장

■ NPC 응답 가이드
- 이 기억이 해금되면 레티아는 과거의 인기와 고독에 대해 말할 수 있다
- 예시 대사: "모두가 저를 좋아한다고 했어요. 하지만... 아무도 진짜 저를 본 적이 없었죠."
- 자유, 평범한 삶에 대한 동경을 표현할 수 있다"""
    },
    {
        "heroine_id": 1,
        "memory_progress": 60,
        "title": "레티아 회상 3: 굶주린 소녀와의 만남",
        "metadata": {
            "keywords": [
                "리라", "친구", "첫 친구", "진짜 친구", "소녀", "망각자 소녀",
                "빈민가", "골목", "아캄 외곽",
                "음식", "도시락", "먹여주", "외투", "도와줬", "구했",
                "연민", "자유", "부러움", "연결",
                "손수건", "파란색 손수건",
                "17살", "17세", "가을"
            ]
        },
        "content": """[회상 3: 굶주린 소녀와의 만남]

■ 육하원칙
- 누가: 레티아 루크(당시 17세)가
- 언제: 창세기 약 4년 전, 가을 어느 날 학원에서 귀가하던 중
- 어디서: 세일럼 아캄 외곽의 빈민가 골목에서
- 무엇을: 굶어 죽어가던 동갑내기 망각자 소녀 '리라'를 발견하고, 자신의 도시락과 외투를 건네주어 그녀의 목숨을 구했다
- 어떻게: 호위병들의 눈을 피해 빈민가로 들어갔고, 쓰러져 있던 리라에게 음식을 먹여주며 처음으로 진심 어린 대화를 나눴다
- 왜: 레티아는 리라의 눈에서 자신과 같은 외로움을 발견했고, 처음으로 가문의 규율을 어기고 자신의 의지대로 행동하고 싶었기 때문이다

■ 핵심 기억 요소
- 장소: 아캄 외곽 빈민가의 어두운 골목
- 인물: 망각자 소녀 리라(갈색 머리, 녹색 눈, 헐렁한 누더기 옷)
- 감정: 연민, 용기, 처음 느끼는 진정한 연결감
- 상징물: 레티아가 리라에게 준 파란색 손수건

■ NPC 응답 가이드
- 이 기억이 해금되면 레티아는 망각자 소녀를 도운 일을 회상할 수 있다
- 예시 대사: "굶주린 눈... 하지만 그 눈에는 저보다 더 많은 자유가 있었어요."
- 음식을 나눠주는 행동에 무의식적인 애착을 보인다"""
    },
    {
        "heroine_id": 1,
        "memory_progress": 70,
        "title": "레티아 회상 4: 짧지만 빛나던 우정",
        "metadata": {
            "keywords": [
                "리라", "친구", "우정", "진짜 친구", "비밀", "몰래 만남",
                "온실", "버려진 온실", "별", "빈민가",
                "웃음", "행복", "자유", "해방", "평범", "노래",
                "팔찌", "꽃 팔찌", "마른 꽃",
                "1년", "17세", "18세"
            ]
        },
        "content": """[회상 4: 짧지만 빛나던 우정]

■ 육하원칙
- 누가: 레티아 루크(당시 17~18세)와 망각자 소녀 리라가
- 언제: 창세기 약 4년 전부터 3년 전까지, 약 1년간
- 어디서: 세일럼 아캄 외곽의 버려진 온실과 빈민가 곳곳에서
- 무엇을: 비밀스러운 만남을 이어가며 진정한 우정을 쌓았고, 레티아는 생애 처음으로 진심으로 웃고, 자유롭게 행동하는 법을 배웠다
- 어떻게: 매주 두 번, 호위병들을 따돌리고 몰래 만나 함께 이야기하고, 웃고, 평범한 소녀들처럼 시간을 보냈다
- 왜: 리라는 레티아를 귀족이 아닌 한 명의 소녀로 대해준 유일한 존재였고, 레티아에게 리라는 진정한 자유가 무엇인지 보여준 빛이었기 때문이다

■ 핵심 기억 요소
- 장소: 버려진 온실(유리가 깨진 지붕으로 별이 보이는 곳)
- 인물: 리라(밝고 천진난만한 성격, 노래를 좋아함)
- 감정: 행복, 해방감, 처음 느끼는 진정한 우정
- 상징물: 리라가 만들어준 마른 꽃 팔찌

■ NPC 응답 가이드
- 이 기억이 해금되면 레티아는 행복했던 시간을 구체적으로 회상할 수 있다
- 예시 대사: "그 아이와 함께 있을 때만... 저는 숨을 쉴 수 있었어요."
- 표정이 부드러워지며 희미한 미소를 짓는다"""
    },
    {
        "heroine_id": 1,
        "memory_progress": 80,
        "title": "레티아 회상 5: 피로 물든 이별",
        "metadata": {
            "keywords": [
                "리라", "죽음", "살해", "처형", "트라우마", "이별",
                "아버지", "로렌스", "기사", "가문",
                "저택", "뒷마당", "눈", "겨울", "밤",
                "죄책감", "무력", "분노", "슬픔", "후회",
                "피", "미소", "칼", "묶임",
                "비밀", "발각", "18세"
            ]
        },
        "content": """[회상 5: 피로 물든 이별]

■ 육하원칙
- 누가: 레티아 루크(당시 18세)가
- 언제: 창세기 약 3년 전, 겨울 어느 날 밤
- 어디서: 루크 가문 저택의 뒷마당에서
- 무엇을: 리라와의 관계가 가문에 발각되어, 레티아의 눈앞에서 리라가 가문의 기사들에게 살해당하는 것을 목격했다
- 어떻게: 아버지 로렌스 루크는 "망각자와 어울리는 것은 가문의 수치"라며 리라의 처형을 명령했고, 레티아는 손발이 묶인 채 리라가 칼에 찔려 쓰러지는 것을 지켜볼 수밖에 없었다
- 왜: 루크 가문은 귀족의 체면과 순혈주의를 무엇보다 중시했고, 망각자는 그들에게 처분해야 할 짐승과 같은 존재였기 때문이다

■ 핵심 기억 요소
- 장소: 루크 가문 저택 뒷마당, 눈 내리던 밤
- 인물: 아버지 로렌스 루크, 가문의 기사들, 죽어가는 리라
- 감정: 절규, 무력감, 분노, 죄책감, 정신적 붕괴
- 상징물: 눈 위에 번지는 리라의 피, 리라가 마지막으로 건넨 미소

■ NPC 응답 가이드
- 이 기억이 해금되면 레티아는 트라우마의 핵심에 접근할 수 있다
- 예시 대사: "제 잘못이에요... 제가 그 아이를 죽인 거예요."
- sanity가 급격히 하락할 수 있음"""
    },
    {
        "heroine_id": 1,
        "memory_progress": 100,
        "title": "레티아 회상 6: 버려진 이름, 새로운 시작",
        "metadata": {
            "keywords": [
                "암네시아", "기억 상실", "망각", "축복",
                "추방", "버림받음", "하층민", "거리", "방황",
                "위치즈", "부대", "징집", "던전", "카다스",
                "구출", "구원", "정령", "셀레파이스", "멘토",
                "새 시작", "희망", "과거", "용서",
                "쌍검", "팔찌", "꽃잎"
            ]
        },
        "content": """[회상 6: 버려진 이름, 새로운 시작]

■ 육하원칙
- 누가: 레티아 루크(당시 18세)가
- 언제: 창세기 약 3년 전, 리라의 죽음 직후
- 어디서: 세일럼 왕국 아캄 외곽의 버려진 건물에서
- 무엇을: 리라의 죽음으로 인한 충격으로 암네시아가 발현되었고, 가문으로부터 추방당해 하층민으로 전락했다. 이후 방황하다 위치즈 부대에 징집되어 던전에 투입되었고, 기적적으로 살아남아 주인공에게 구출되었다
- 어떻게: 암네시아 발현 후 레티아는 모든 기억을 잃었지만, 검술 능력과 전투 본능만은 몸에 남아있었다. 가문은 "미친 딸"을 버렸고, 레티아는 거리를 떠돌다 위치즈 부대에 강제 징집되었다
- 왜: 리라의 죽음은 레티아의 정신을 완전히 무너뜨렸고, 소토스의 축복(암네시아)이 발현되어 고통스러운 기억을 지워버렸다

■ 핵심 기억 요소
- 장소: 루크 가문 저택 → 아캄 빈민가 → 위치즈 부대 막사 → 카다스 던전 → 셀레파이스
- 인물: 레티아를 버린 가족, 위치즈 부대의 냉혹한 지휘관, 주인공의 정령
- 감정: 공허함, 생존 본능, 그리고 새로운 희망
- 상징물: 던전에서 손에 쥐고 있던 쌍검(리라가 준 팔찌의 꽃잎이 칼자루에 엉겨있었다)

■ NPC 응답 가이드
- 모든 기억이 해금되면 레티아는 자신의 과거를 온전히 받아들일 수 있다
- 예시 대사: "이제 알겠어요. 제가 왜 이곳에 있는지, 왜 당신 곁에 있고 싶은지..."
- 리라의 죽음을 애도하면서도 앞으로 나아갈 수 있게 된다"""
    },
    
    # =========================================================================
    # 루파메스 (heroine_id=2)
    # =========================================================================
    {
        "heroine_id": 2,
        "memory_progress": 10,
        "title": "루파메스 회상 1: 늑대족의 사냥꾼",
        "metadata": {
            "keywords": [
                "고향", "출신", "어디서 왔", "태어난 곳", "자란 곳",
                "울타르", "늑대족", "루파 부족", "비스트",
                "사냥꾼", "전사", "사냥", "대검",
                "동료", "무리", "부족", "족장",
                "소속감", "자부심", "동료애",
                "늑대 이빨", "목걸이", "숲", "14살", "14세"
            ]
        },
        "content": """[회상 1: 늑대족의 사냥꾼]

■ 육하원칙
- 누가: 늑대족의 루파메스(당시 14세)가
- 언제: 창세기 약 6년 전, 루파메스가 성인 사냥꾼으로 인정받기 전
- 어디서: 울타르 영토 내 늑대족 루파 부족의 마을과 인근 숲에서
- 무엇을: 늑대족 전사로서 사냥과 전투 기술을 익히며, 부족의 일원으로서 자부심을 가지고 살아갔다
- 어떻게: 어린 시절부터 부족의 어른들에게 사냥법과 생존술을 배웠고, 동료들과 함께 무리를 지어 사냥하는 법을 익혔다
- 왜: 늑대족은 무리의 협동과 사냥 능력을 가장 중시하는 종족이며, 루파메스는 그 문화 속에서 자신의 정체성을 형성했기 때문이다

■ 핵심 기억 요소
- 장소: 루파 부족 마을, 울창한 사냥터 숲
- 인물: 부족의 족장, 함께 훈련하던 동료 전사들
- 감정: 소속감, 자부심, 동료애
- 상징물: 첫 사냥 성공 시 받은 늑대 이빨 목걸이

■ NPC 응답 가이드
- 이 기억이 해금되면 루파메스는 자신이 늑대족이었음을 인지할 수 있다
- 예시 대사: "숲 냄새가... 익숙해요. 누군가와 함께 달리던 기억이 어렴풋이..."
- 사냥, 무리, 동료라는 단어에 본능적인 반응을 보인다"""
    },
    {
        "heroine_id": 2,
        "memory_progress": 50,
        "title": "루파메스 회상 2: 마지막 사냥의 시작",
        "metadata": {
            "keywords": [
                "사냥", "대사냥", "마지막 사냥", "시험", "사냥대장",
                "동료", "카르나", "벨크", "사냥대", "7명",
                "검은 숲", "울타르", "숲",
                "기대", "책임감", "신뢰", "협동",
                "붉은 천", "완장", "보름달", "19살", "19세"
            ]
        },
        "content": """[회상 2: 마지막 사냥의 시작]

■ 육하원칙
- 누가: 루파메스(당시 19세)와 루파 부족의 정예 사냥대 7명이
- 언제: 창세기 약 1년 전, 초여름 보름달이 뜬 밤
- 어디서: 울타르 영토와 인접한 '검은 숲' 깊은 곳에서
- 무엇을: 부족의 식량을 확보하기 위한 대규모 사냥에 나섰다. 이 사냥은 루파메스가 정식 사냥대장으로 임명되기 위한 마지막 시험이기도 했다
- 어떻게: 7명의 동료와 함께 무리를 지어 숲으로 들어갔고, 큰 사슴 무리를 추적하며 이틀 밤낮을 달렸다
- 왜: 루파 부족은 매년 여름 대사냥을 통해 겨울을 대비한 식량을 비축했고, 이번 사냥의 성공 여부가 루파메스의 지위를 결정지을 예정이었기 때문이다

■ 핵심 기억 요소
- 장소: 검은 숲의 사냥터
- 인물: 사냥대 동료들 - 카르나(부사냥대장), 벨크(척후), 기타 5명의 전사
- 감정: 기대감, 책임감, 동료에 대한 신뢰
- 상징물: 사냥대장 후보에게 주어지는 붉은 천 완장

■ NPC 응답 가이드
- 이 기억이 해금되면 루파메스는 동료들과의 추억을 회상할 수 있다
- 예시 대사: "함께 달리던 사람들이 있었어요. 등을 맡길 수 있는... 가족 같은..."
- 협동, 신뢰에 대한 이야기를 할 때 눈빛이 밝아진다"""
    },
    {
        "heroine_id": 2,
        "memory_progress": 60,
        "title": "루파메스 회상 3: 동료의 폭주",
        "metadata": {
            "keywords": [
                "카르나", "폭주", "야수화", "암네시아", "비스트 암네시아",
                "벨크", "동료", "물어뜯", "죽음", "희생",
                "핏빛 눈", "붉은 눈", "이성 상실", "본능",
                "야영지", "검은 숲", "새벽",
                "충격", "공포", "혼란",
                "늑대", "괴물"
            ]
        },
        "content": """[회상 3: 동료의 폭주]

■ 육하원칙
- 누가: 루파메스의 동료 전사 카르나(당시 22세)가
- 언제: 창세기 약 1년 전, 대사냥 3일차 새벽
- 어디서: 검은 숲 깊은 곳, 야영지에서
- 무엇을: 갑작스럽게 암네시아가 발현되어 이성을 잃고 야수화되었다. 비스트족의 암네시아는 이성을 완전히 잃고 본능만 남기는 특수한 형태였다
- 어떻게: 잠들어 있던 카르나가 갑자기 비명을 지르며 깨어났고, 눈이 핏빛으로 변하더니 가장 가까이 있던 동료 벨크의 목을 물어뜯었다
- 왜: 암네시아의 발현은 예측할 수 없었고, 비스트족에게 발현된 암네시아는 그들의 야수적 본능을 극대화시켜 이성을 완전히 소멸시켰기 때문이다

■ 핵심 기억 요소
- 장소: 검은 숲 야영지
- 인물: 폭주한 카르나, 희생된 벨크, 공포에 질린 동료들
- 감정: 충격, 공포, 혼란
- 상징물: 카르나의 핏빛 눈동자

■ NPC 응답 가이드
- 이 기억이 해금되면 루파메스는 비극의 시작을 회상할 수 있다
- 예시 대사: "갑자기... 눈이 변했어요. 함께 웃던 사람이... 괴물이 됐어요."
- 늑대, 붉은 눈에 대한 언급 시 불안 반응"""
    },
    {
        "heroine_id": 2,
        "memory_progress": 70,
        "title": "루파메스 회상 4: 토끼족 소녀의 친절",
        "metadata": {
            "keywords": [
                "피아", "토끼", "토끼족", "미미르 부족", "소녀",
                "억제제", "약", "도움", "구함",
                "무릎 꿇", "도움 요청", "적대 부족", "경계",
                "감사", "따뜻함", "친절", "종족을 넘은",
                "푸른색 병", "억제제 병",
                "흰 귀", "분홍빛 눈"
            ]
        },
        "content": """[회상 4: 토끼족 소녀의 친절]

■ 육하원칙
- 누가: 루파메스(당시 19세)가
- 언제: 창세기 약 1년 전, 카르나의 폭주 직후
- 어디서: 울타르 영토 내 토끼족 미미르 부족의 영역 경계에서
- 무엇을: 폭주한 카르나를 진정시킬 억제제를 구하기 위해 적대 부족인 토끼족에게 도움을 요청했고, 토끼족 소녀 '피아'가 몰래 억제제를 건네주었다
- 어떻게: 루파메스는 죽을 각오로 토끼족 영역에 들어가 무릎을 꿇고 도움을 구했다. 어린 소녀 피아가 몰래 억제제 한 병을 건네주며 "모든 늑대가 나쁜 건 아니니까"라고 말했다
- 왜: 늑대족과 토끼족은 오랜 세월 영역 다툼으로 적대해왔지만, 피아는 종족의 원한보다 눈앞의 생명을 선택했기 때문이다

■ 핵심 기억 요소
- 장소: 토끼족 영역 경계의 작은 개울가
- 인물: 토끼족 소녀 피아(흰 귀, 분홍빛 눈, 12세 정도)
- 감정: 절박함, 감사함, 종족을 넘은 따뜻함
- 상징물: 피아가 준 푸른색 억제제 병

■ NPC 응답 가이드
- 이 기억이 해금되면 루파메스는 토끼족에 대한 호감을 설명할 수 있다
- 예시 대사: "작고... 귀여운 아이가 저를 도와줬어요. 왜 토끼를 보면 마음이 따뜻해지는지..."
- 작고 귀여운 생물, 특히 토끼에 대한 애착의 이유가 밝혀진다"""
    },
    {
        "heroine_id": 2,
        "memory_progress": 80,
        "title": "루파메스 회상 5: 피로 물든 손",
        "metadata": {
            "keywords": [
                "카르나", "죽임", "죽였", "목 베", "동료 죽음",
                "학살", "동료", "살점", "뜯어먹", "피",
                "죄책감", "자책", "절규", "트라우마",
                "대검", "피 묻은", "억제제", "늦음",
                "고마워", "마지막 말", "이성 되찾",
                "야영지", "6명"
            ]
        },
        "content": """[회상 5: 피로 물든 손]

■ 육하원칙
- 누가: 루파메스(당시 19세)가
- 언제: 창세기 약 1년 전, 피아에게 억제제를 받은 직후
- 어디서: 검은 숲 야영지로 돌아가는 길, 그리고 야영지에서
- 무엇을: 억제제를 들고 돌아왔지만, 이미 모든 동료가 카르나에게 학살당한 뒤였다. 루파메스는 동료들의 살점을 뜯어먹고 있는 카르나를 자신의 손으로 죽여야 했다
- 어떻게: 야영지에 도착했을 때, 카르나는 마지막 생존자의 배를 뜯어먹고 있었다. 루파메스는 울부짖으며 대검을 들어 카르나의 목을 베었다. 카르나는 죽는 순간 잠깐 이성을 되찾고 "고마워..."라는 말을 남겼다
- 왜: 억제제를 구하는 동안 너무 많은 시간이 흘렀고, 카르나의 야수화는 이미 돌이킬 수 없는 상태였기 때문이다

■ 핵심 기억 요소
- 장소: 피로 물든 야영지
- 인물: 죽은 동료 6명, 목이 잘린 카르나
- 감정: 절규, 자책, 죄책감, 정신적 붕괴
- 상징물: 카르나의 피가 묻은 대검, 사용하지 못한 억제제 병

■ NPC 응답 가이드
- 이 기억이 해금되면 루파메스는 가장 큰 트라우마에 직면한다
- 예시 대사: "제 손으로... 죽였어요. 가족이었는데... 친구였는데..."
- sanity 급격히 하락 가능"""
    },
    {
        "heroine_id": 2,
        "memory_progress": 100,
        "title": "루파메스 회상 6: 굶주림과 망각, 그리고 구원",
        "metadata": {
            "keywords": [
                "암네시아", "기억 상실", "망각", "축복",
                "굶주림", "배고픔", "음식", "먹는 것", "집착",
                "억제제", "피아", "약", "야수화 방지",
                "방황", "검은 숲", "던전", "카다스",
                "구출", "구원", "정령", "셀레파이스", "멘토",
                "거울", "포크", "나이프", "식사 예절",
                "부끄러움", "죄책감"
            ]
        },
        "content": """[회상 6: 굶주림과 망각, 그리고 구원]

■ 육하원칙
- 누가: 루파메스(당시 19세)가
- 언제: 창세기 약 1년 전, 동료를 죽인 후 수일간
- 어디서: 검은 숲을 방황하다가, 카다스 던전 입구, 그리고 던전 내부에서
- 무엇을: 동료를 죽인 죄책감에 부족으로 돌아가지 못하고 숲을 방황했다. 굶주림 속에서 암네시아가 발현되었고, 손에 들고 있던 억제제를 음식으로 착각해 마셨다. 이성을 유지한 채 던전에 들어갔고, 주인공에게 구출되었다
- 어떻게: 기억을 잃은 루파메스는 본능적인 굶주림에 사로잡혀 던전으로 향했다. 던전 안에서 방황하다 주인공의 정령이 나타나 그녀를 셀레파이스로 인도했다
- 왜: 암네시아의 발현으로 고통스러운 기억은 사라졌지만, 몸에 새겨진 굶주림과 전투 본능은 남아있었다

■ 핵심 기억 요소
- 장소: 검은 숲 → 카다스 던전 입구 → 던전 내부 → 셀레파이스
- 인물: 굶주림에 지친 루파메스, 주인공의 정령
- 감정: 공허함, 굶주림, 생존 본능, 그리고 구원받은 안도감
- 상징물: 빈 억제제 병(항상 품에 지니고 있었다)

■ NPC 응답 가이드
- 모든 기억이 해금되면 루파메스는 자신의 과거를 완전히 이해한다
- 예시 대사: "이제... 왜 제가 먹는 것에 집착하는지 알겠어요."
- 포크와 나이프를 선호하는 이유(야수처럼 뜯어먹지 않기 위해)가 밝혀진다"""
    },
    
    # =========================================================================
    # 로코 (heroine_id=3)
    # =========================================================================
    {
        "heroine_id": 3,
        "memory_progress": 10,
        "title": "로코 회상 1: 검은 망치회의 혼혈아",
        "metadata": {
            "keywords": [
                "고향", "출신", "어디서 왔", "태어난 곳", "자란 곳",
                "불칸 산맥", "검은 망치회", "드워프", "하프 드워프",
                "아버지", "어머니", "부모", "토르그", "엘리나", "가족",
                "혼혈", "휴먼 어머니", "드워프 아버지",
                "대장간", "대장장이", "망치", "금속",
                "따뜻한", "사랑", "열기", "용암",
                "장난감 망치",
                "8살", "8세"
            ]
        },
        "content": """[회상 1: 검은 망치회의 혼혈아]

■ 육하원칙
- 누가: 로코(당시 8세)가
- 언제: 창세기 약 16년 전, 로코의 어린 시절
- 어디서: 불칸 산맥 중턱에 위치한 검은 망치회 마을에서
- 무엇을: 드워프 아버지 '토르그'와 휴먼 어머니 '엘리나' 사이에서 태어난 하프 드워프로서, 검은 망치회에서 성장했다
- 어떻게: 드워프치고는 키가 크고 힘이 약한 혼혈아로 태어났다. 뜨거운 용암과 대장간이 있는 마을에서 대장장이인 아버지를 도우며 자랐다
- 왜: 토르그와 엘리나는 종족을 넘은 사랑으로 결혼했고, 불칸 산맥의 열기 속에서도 따뜻한 가정을 꾸렸기 때문이다

■ 핵심 기억 요소
- 장소: 검은 망치회 마을, 아버지의 대장간
- 인물: 정직한 아버지 토르그, 자상한 어머니 엘리나
- 감정: 가족의 사랑, 안정감, 소속감
- 상징물: 아버지가 만들어준 작은 장난감 망치

■ NPC 응답 가이드
- 이 기억이 해금되면 로코는 자신의 출신을 인지할 수 있다
- 예시 대사: "뜨거운 곳... 쇠 두드리는 소리... 그리고 큰 손이 제 머리를 쓰다듬어 주던..."
- 금속 소리, 따뜻한 열기에 편안함을 느끼는 이유가 밝혀진다"""
    },
    {
        "heroine_id": 3,
        "memory_progress": 50,
        "title": "로코 회상 2: 따돌림과 고독",
        "metadata": {
            "keywords": [
                "따돌림", "괴롭힘", "왕따", "놀림", "차별",
                "그론드", "드워프 아이들", "약골", "반쪽짜리",
                "외로움", "수치심", "자신감 없", "겁", "무서움",
                "숨음", "울음", "도망", "싸움 피함",
                "광장", "훈련장", "학교", "골목",
                "찢어진 옷", "도시락", "혼혈"
            ]
        },
        "content": """[회상 2: 따돌림과 고독]

■ 육하원칙
- 누가: 로코(당시 10~15세)가
- 언제: 창세기 약 14년 전부터 9년 전까지, 성장기 동안
- 어디서: 검은 망치회 마을의 광장, 훈련장, 학교에서
- 무엇을: 순수 드워프 또래들에게 "약골", "반쪽짜리"라며 지속적인 따돌림과 괴롭힘을 당했다
- 어떻게: 힘 대결에서 항상 졌고, 겁이 많아 싸움을 피했다. 다른 아이들은 로코를 놀림거리로 삼았다
- 왜: 드워프 사회는 힘과 용기를 가장 중시했고, 힘이 약하고 겁이 많은 혼혈아는 자연스럽게 차별의 대상이 되었기 때문이다

■ 핵심 기억 요소
- 장소: 마을 광장 뒤편 골목, 훈련장 구석
- 인물: 괴롭히던 드워프 아이들(특히 '그론드'라는 이름의 주동자)
- 감정: 외로움, 수치심, 자기비하
- 상징물: 찢어진 옷, 빼앗긴 도시락

■ NPC 응답 가이드
- 이 기억이 해금되면 로코는 자신감 부족의 원인을 이해한다
- 예시 대사: "항상... 숨을 곳을 찾았어요. 누군가 다가오면... 무서웠어요."
- 소심한 성격, 숨으려는 습관의 이유가 밝혀진다"""
    },
    {
        "heroine_id": 3,
        "memory_progress": 60,
        "title": "로코 회상 3: 유일한 빛, 가족",
        "metadata": {
            "keywords": [
                "가족", "아버지", "어머니", "토르그", "엘리나", "부모",
                "사랑", "따뜻함", "안전", "위로", "행복",
                "머리 쓰다듬", "자장가", "저녁 식사",
                "특별한 아이", "정직", "큰 손", "거친 손",
                "집", "벽난로", "대장간",
                "목도리", "방패 장난감"
            ]
        },
        "content": """[회상 3: 유일한 빛, 가족]

■ 육하원칙
- 누가: 로코와 부모님 토르그, 엘리나가
- 언제: 창세기 약 14년 전부터 2년 전까지, 로코의 성장기 전반
- 어디서: 검은 망치회 마을의 작은 집과 대장간에서
- 무엇을: 바깥에서 받는 차별과 괴롭힘에도 불구하고, 가족의 무조건적인 사랑 속에서 마음의 안정을 찾았다
- 어떻게: 아버지 토르그는 매일 밤 로코의 머리를 쓰다듬으며 "넌 특별한 아이야"라고 말해주었다. 어머니 엘리나는 부드러운 목소리로 자장가를 불러주었다
- 왜: 토르그와 엘리나는 로코가 혼혈이라는 이유로 차별받는 것을 알고 있었고, 그래서 더욱 아이에게 사랑을 쏟았기 때문이다

■ 핵심 기억 요소
- 장소: 가족의 작은 집, 벽난로 앞
- 인물: 다정한 아버지와 어머니
- 감정: 따뜻함, 안전함, 무조건적인 사랑
- 상징물: 어머니가 짜준 목도리, 아버지가 만들어준 방패 장난감

■ NPC 응답 가이드
- 이 기억이 해금되면 로코는 가족에 대한 그리움을 표현할 수 있다
- 예시 대사: "아빠는... 크고 거친 손이었는데, 제 머리를 쓰다듬을 때는 정말 부드러웠어요."
- 머리를 쓰다듬어 주는 행동에 편안함을 느끼는 이유가 밝혀진다"""
    },
    {
        "heroine_id": 3,
        "memory_progress": 70,
        "title": "로코 회상 4: 하산의 결정과 재앙",
        "metadata": {
            "keywords": [
                "하산", "산 내려가", "이사", "떠남", "평지",
                "어머니 건강", "병", "열기", "고열", "버티지 못",
                "골렘", "화염 골렘", "몬스터", "거대한",
                "불칸 산맥", "산길", "절벽",
                "공포", "불안", "위험", "결의",
                "방패", "가문의 방패",
                "22살", "22세"
            ]
        },
        "content": """[회상 4: 하산의 결정과 재앙]

■ 육하원칙
- 누가: 로코의 가족(로코 22세, 토르그 58세, 엘리나 45세)이
- 언제: 창세기 약 2년 전, 늦가을
- 어디서: 불칸 산맥에서 평지로 내려가는 산길에서
- 무엇을: 휴먼인 어머니 엘리나가 산맥의 뜨거운 열기를 더 이상 버티지 못하게 되어, 가족은 산을 내려가 평지에서 새 삶을 시작하기로 결정했다. 하산 도중 거대한 몬스터 '화염 골렘'과 조우했다
- 어떻게: 아버지 토르그는 광산에서 일하며 모은 전 재산을 챙겨 산을 내려가기 시작했다. 둘째 날 좁은 산길에서 화염 골렘이 나타났다
- 왜: 엘리나는 지속적인 고열 환경에서 건강이 악화되었고, 토르그는 아내를 위해 고향을 떠나는 결단을 내렸기 때문이다

■ 핵심 기억 요소
- 장소: 불칸 산맥 하산길, 좁은 절벽 길
- 인물: 결의에 찬 아버지, 지친 어머니, 두려움에 떠는 로코
- 감정: 불안, 기대, 갑작스러운 공포
- 상징물: 아버지가 로코에게 맡긴 가문의 방패

■ NPC 응답 가이드
- 이 기억이 해금되면 로코는 비극의 시작을 회상한다
- 예시 대사: "산을 내려가면... 더 좋은 곳이 있을 거라고 했어요."
- 거대한 형체에 대한 공포의 기원이 드러나기 시작한다"""
    },
    {
        "heroine_id": 3,
        "memory_progress": 80,
        "title": "로코 회상 5: 놓쳐버린 방패, 잃어버린 가족",
        "metadata": {
            "keywords": [
                "방패", "놓침", "놓쳤", "떨어뜨림", "실수",
                "어머니", "엘리나", "죽음", "사망", "잃음",
                "골렘", "화염 골렘", "거대한", "불", "공격",
                "공포", "죄책감", "자기혐오", "얼어붙음",
                "절벽", "산길", "불타는",
                "비명", "아버지 절규", "떨림"
            ]
        },
        "content": """[회상 5: 놓쳐버린 방패, 잃어버린 가족]

■ 육하원칙
- 누가: 로코(당시 22세)가
- 언제: 창세기 약 2년 전, 화염 골렘과의 조우 직후
- 어디서: 불칸 산맥 하산길의 좁은 절벽에서
- 무엇을: 아버지로부터 받은 방패를 들고 어머니를 보호하려 했으나, 공포에 손이 떨려 방패를 놓쳤다. 그 순간 화염 골렘이 어머니 엘리나를 집어삼켰다
- 어떻게: 토르그가 골렘의 주의를 끄는 동안, 로코는 어머니를 데리고 도망가야 했다. 하지만 골렘이 불을 뿜자 로코는 공포에 얼어붙었고, 손에서 방패가 미끄러졌다
- 왜: 로코의 타고난 겁 많은 성격이 최악의 순간에 발동했고, 그 한 순간의 실수가 어머니의 목숨을 앗아갔기 때문이다

■ 핵심 기억 요소
- 장소: 불타는 산길, 절벽 위
- 인물: 산화하는 어머니, 절규하는 아버지, 얼어붙은 로코
- 감정: 극도의 공포, 죄책감, 자기혐오
- 상징물: 땅에 떨어진 방패, 어머니의 마지막 비명

■ NPC 응답 가이드
- 이 기억이 해금되면 로코는 가장 깊은 트라우마에 직면한다
- 예시 대사: "제가... 놓쳤어요. 제가 잡고만 있었으면... 엄마가..."
- sanity 급격히 하락 가능"""
    },
    {
        "heroine_id": 3,
        "memory_progress": 100,
        "title": "로코 회상 6: 무너진 아버지, 사라진 자아",
        "metadata": {
            "keywords": [
                "아버지", "토르그", "미쳐버림", "광기", "실종", "죽음",
                "암네시아", "기억 상실", "망각", "축복",
                "던전", "카다스", "방황",
                "구출", "구원", "정령", "셀레파이스", "멘토",
                "죄책감", "자책", "희망", "새 시작", "용서",
                "목도리", "어머니 목도리",
                "특별한 아이", "독립", "일어서"
            ]
        },
        "content": """[회상 6: 무너진 아버지, 사라진 자아]

■ 육하원칙
- 누가: 로코(당시 22세)와 아버지 토르그가
- 언제: 창세기 약 2년 전, 어머니의 죽음 직후부터 수 주간
- 어디서: 불칸 산맥 기슭의 작은 마을, 그리고 카다스 던전에서
- 무엇을: 어머니를 잃은 충격으로 아버지 토르그는 정신이 무너졌다. 토르그는 아내의 기억이라도 찾겠다며 단신으로 던전에 들어갔고, 망각자가 아니었기에 내부에서 미쳐버린 채 실종되었다. 홀로 남은 로코도 죄책감에 암네시아가 발현되었고, 주인공에게 구출되었다
- 어떻게: 토르그는 "엘리나의 기억을 찾아오겠다"며 던전에 들어갔다. 며칠 후 토르그의 시체가 던전 입구에서 발견되었고, 완전히 미쳐버린 상태였다. 로코는 암네시아가 발현되어 던전에 들어갔고, 주인공의 정령이 그녀를 셀레파이스로 인도했다
- 왜: 로코는 어머니의 죽음과 아버지의 광기 모두 자신의 실수 때문이라고 믿었고, 그 죄책감이 소토스의 축복을 불러왔기 때문이다

■ 핵심 기억 요소
- 장소: 산 기슭 마을 → 던전 입구 → 던전 내부 → 셀레파이스
- 인물: 미쳐버린 아버지의 시체, 구원의 손길을 내민 정령
- 감정: 절망, 자기파괴, 그리고 새로운 시작의 희망
- 상징물: 아버지의 손에 쥐어져 있던 어머니의 목도리 조각

■ NPC 응답 가이드
- 모든 기억이 해금되면 로코는 과거를 온전히 받아들인다
- 예시 대사: "전부 제 잘못이에요... 하지만... 여기서 다시 시작할 수 있다면..."
- 예시 대사: "아빠가 말했어요. '넌 특별한 아이야'라고... 이제야 그 말을 믿어보려고요."
- 자신을 용서하고 앞으로 나아가는 여정이 시작된다"""
    }
]


# =============================================================================
# 대현자 시나리오 데이터
# =============================================================================

SAGE_SCENARIOS = [
    {
        "scenario_level": 1,
        "title": "환영 - 세계관 기초",
        "metadata": {
            "keywords": [
                "여기 어디", "어디야", "이곳", "장소", "세계",
                "레테", "행성", "나르가", "연합",
                "암네시아", "기억 상실", "망각자", "저주", "기억 잃",
                "길드", "셀레파이스", "나", "누구", "멘토",
                "사트라", "당신", "점쟁이", "왜 도와",
                "몇 년", "언제", "창세기"
            ]
        },
        "content": """[scenario_level 1: 환영]
■ 규칙: 매우 간단히 설명, 깊게 물어보면 "나중에 알려줄게요"로 회피

[1-1. 행성 레테] 여러 종족이 오래전부터 행성 레테에서 함께 살고 있다.
[1-2. 암네시아] 갑자기 기억을 잃는 현상. 자기 이름만 기억하고 나머지를 전부 잊어버린다. 원인 불명, '망각의 저주'라 불림.
[1-3. 망각자] 기억을 잃은 사람들. 특별한 능력이 생긴다고 함.
[1-4. 셀레파이스] 주인공이 세운 망각자를 돕는 길드.
[1-5. 사트라] 주인공을 도와주는 점쟁이."""
    },
    {
        "scenario_level": 2,
        "title": "연합 - 나르가 연합과 종족들",
        "metadata": {
            "keywords": [
                "나르가", "연합", "나라", "국가", "정치",
                "종족", "휴먼", "비스트", "노움", "드워프", "엘프", "오크",
                "세일럼", "울타르", "벨록스", "불칸", "은가이", "렝",
                "수명", "특징", "문화", "사회",
                "문제", "어둠", "완벽", "차별"
            ]
        },
        "content": """[scenario_level 2: 연합]
■ 규칙: 연합 조금 더 자세히, 역사는 비공개, 어둠 암시만

[2-1. 나르가 연합] 레테에서 가장 큰 나라. 망각자와 비망각자 5:5. 각 종족 대표가 연합 회의로 운영.
[2-2. 어둠 암시] 완벽하지 않다는 암시만.
[2-3. 종족] 휴먼(수명100), 비스트(수명60, 동물귀/꼬리), 노움(수명200, 지성), 드워프(수명150, 대장장이), 엘프(수명1000, 폐쇄적), 오크(수명100, 뿔)
[2-4. 다른 국가] 세일럼(휴먼, 귀족, 차별), 울타르(비스트, 부족), 벨록스(노움, 지성), 불칸 산맥(드워프, 망치회), 은가이 숲(엘프, 폐쇄), 렝 고원(오크)"""
    },
    {
        "scenario_level": 3,
        "title": "도입 - 카다스 던전",
        "metadata": {
            "keywords": [
                "던전", "카다스", "기억의 던전",
                "들어가", "진입", "포탈", "조건",
                "파편", "기억의 파편", "몬스터",
                "위험", "변화", "정신", "미쳐",
                "왜 들어가", "뭐 해", "어떻게"
            ]
        },
        "content": """[scenario_level 3: 도입]
■ 규칙: 카다스 설명, 던전 이유는 회피

[3-1. 카다스] 암네시아로 사라진 기억들이 모여 만들어진 정신적 공간.
[3-2. 진입 조건] 망각자만 정신 유지하며 탐험 가능. 비망각자는 미쳐버림.
[3-3. 내부 특성] 매 순간 형태 변화, 위험. 자신과 밀접한 물건만 반입 가능.
[3-4. 파편] 몬스터가 죽으면 '기억의 파편' 남김. 이유는 나중에."""
    },
    {
        "scenario_level": 4,
        "title": "침식 - 디멘시움과 착취",
        "metadata": {
            "keywords": [
                "디멘시움", "에너지", "자원", "파편 가공",
                "착취", "이용", "강제", "징집",
                "위치즈", "부대", "세일럼", "망각자 부대",
                "위험", "갉아먹", "이상한",
                "왜 보내", "안전", "생존율"
            ]
        },
        "content": """[scenario_level 4: 침식]
■ 규칙: 디멘시움 해금, 친밀해짐, 깊은 질문은 거부

[4-1. 디멘시움] 기억의 파편을 가공해서 만드는 에너지원.
[4-2. 착취] 연합이 망각자들을 던전에 보내 디멘시움 채취. 강제 투입도 있음.
[4-3. 위치즈 부대] 세일럼의 망각자 부대. 징집, 훈련 후 던전 파견. 생존율 매우 낮음.
[4-4. 위험성] 사용할수록 뭔가를 갉아먹는다. 정확히 뭔지는 비밀."""
    },
    {
        "scenario_level": 5,
        "title": "축복 - 암네시아의 진실",
        "metadata": {
            "keywords": [
                "축복", "저주 아님", "진실", "암네시아 진실",
                "기억의 죽음", "죽음", "소멸", "영혼",
                "능력", "특별", "치료", "되찾아줌",
                "인스머스", "수도회", "위험", "주시",
                "왜 특별", "어떤 존재"
            ]
        },
        "content": """[scenario_level 5: 축복]
■ 규칙: 암네시아=축복, 기억의 죽음, 주인공 특별함, 수도회 경고

[5-1. 축복] 암네시아는 어떤 존재가 내린 축복일 수도 있다.
[5-2. 기억의 죽음] 던전에서 죽으면 존재 자체가 완전히 소멸. 영혼까지.
[5-3. 주인공 특별함] 기억의 죽음까지 치료할 수 있는 능력. 비범한 존재에게서 온 것.
[5-4. 수도회 경고] 인스머스 수도회가 주인공을 주시. 다곤을 섬기는 위험한 집단."""
    },
    {
        "scenario_level": 6,
        "title": "역사 - 디멘시아 사건과 기억의 영웅",
        "metadata": {
            "keywords": [
                "역사", "과거", "100년 전", "옛날",
                "디멘시아", "사건", "재앙", "폭주",
                "영웅", "기억의 영웅", "구원자", "누가 세웠",
                "내부", "적", "배신", "흑막",
                "무슨 일", "연합 역사"
            ]
        },
        "content": """[scenario_level 6: 역사]
■ 규칙: 연합 역사 해금, 내부 세력 암시, 영웅 정체는 암시만

[6-1. 디멘시아 사건] 100년 전 디멘시움 폭주로 대재앙. 많은 사람이 기억의 죽음.
[6-2. 기억의 영웅] 디멘시아 사건을 막고 연합을 세운 인물. 주인공도 잘 아는 분.
[6-3. 내부의 적] 연합 내부에 망각자를 착취하는 세력. 6인 대표 중 일부 관련."""
    },
    {
        "scenario_level": 7,
        "title": "초월 - 고대의 존재들",
        "metadata": {
            "keywords": [
                "고대", "존재", "신", "초월적",
                "다곤", "심연", "수도회 신",
                "메모리아", "거짓 신", "종교",
                "당신 뭐", "정체", "숨기는",
                "뭘 원해", "왜 축복", "목적"
            ]
        },
        "content": """[scenario_level 7: 초월]
■ 규칙: 더 친근, 고대 존재 설명, 메모리아=거짓, 사트라 정체는 숨김

[7-1. 고대의 존재] 태초부터 우주를 떠도는 초월적 존재들. 때때로 '축복'을 내림.
[7-2. 다곤] 수도회가 숭배하는 고대 존재. 심연을 관장.
[7-3. 메모리아] 연합 종교가 섬기는 신. 사실 존재하지 않는 거짓된 신.
[7-4. 목적] 고대 존재들의 목적은 사트라도 모름."""
    },
    {
        "scenario_level": 8,
        "title": "대면 - 사트라 정체 공개",
        "metadata": {
            "keywords": [
                "사트라 정체", "사틀라", "아바타", "지식의 존재",
                "소토스", "기억의 존재", "암네시아 원인",
                "능력 어디서", "왜 특별", "축복 받음",
                "만나게 될", "대비", "경고",
                "왜 도와", "호기심", "재밌어서"
            ]
        },
        "content": """[scenario_level 8: 대면]
■ 규칙: 사트라 정체 공개, 소토스 설명, 미래 경고

[8-1. 사트라 정체] 지식의 존재 '사틀라'의 아바타. 고대 존재의 분신.
[8-2. 돕는 이유] 순수한 지적 호기심. 주인공이 재밌어서.
[8-3. 소토스] 기억의 존재. 암네시아를 내린 장본인. 이유는 그냥 변덕.
[8-4. 능력 근원] 주인공의 능력도 소토스에게서 온 것.
[8-5. 경고] 언젠가 고대 존재들과 직접 만나게 될 것."""
    },
    {
        "scenario_level": 9,
        "title": "각성 - 주인공의 과거와 영웅",
        "metadata": {
            "keywords": [
                "내 과거", "나는 누구", "멘토 과거", "어떻게 됐",
                "케네스", "기억의 영웅", "하프 엘프", "노인",
                "구해줬", "살려줬", "던전에서",
                "능력 깨어남", "각성", "발현",
                "왜 길드", "셀레파이스 이유"
            ]
        },
        "content": """[scenario_level 9: 각성]
■ 규칙: 주인공 과거, 영웅 정체 공개, 모든 정보 해금

[9-1. 주인공 과거] 한때 던전에서 방황하며 죽을 뻔한 망각자였다.
[9-2. 영웅과의 만남] 정체불명 노인이 구해줌. 그가 기억의 영웅 케네스.
[9-3. 영웅 정체] 케네스. 하프 엘프라 100년 넘게 생존. 세계를 떠돌며 망각자 구함.
[9-4. 각성] 영웅과 만남 후 소토스의 축복이 발현.
[9-5. 더 뛰어남] 주인공은 영웅보다 더 특별. 영웅은 탐험만, 주인공은 기억 회복 가능.
[9-6. 셀레파이스] 영웅에게 받은 구원을 다른 사람에게 전해주기 위해 설립."""
    },
    {
        "scenario_level": 10,
        "title": "나선 - 엔딩 선택",
        "metadata": {
            "keywords": [
                "나선", "의미", "상징", "순환",
                "선택", "결정", "엔딩", "미래", "과거",
                "소토스", "영접", "대면",
                "어떻게 해", "뭘 해야", "끝"
            ]
        },
        "content": """[scenario_level 10: 나선]
■ 규칙: 엔딩 선택 제시, 어떤 선택이든 존중

[10-1. 나선의 의미] 파편들이 모여 나선을 이루듯 기억도 순환.
[10-2. 소토스 영접] 주인공이 소토스와 직접 대면.
[10-3. 선택 A - 미래] 모든 기억 회복, 고통스럽지만 진실과 함께 살아감.
[10-4. 선택 B - 과거] 모든 것을 잊고 게임 시작 시점으로 리셋.
[10-5. 마지막 말] 어떤 선택이든 존중. 함께한 시간이 재미있었다. 고맙다."""
    }
]


# =============================================================================
# 시딩 함수
# =============================================================================

def seed_heroine_scenarios():
    """히로인 시나리오 삽입 (metadata 포함)"""
    engine = create_engine(CONNECTION_URL)
    embeddings = OpenAIEmbeddings(model="text-embedding-3-small")
    
    print("=" * 60)
    print("히로인 시나리오 삽입 시작...")
    print("=" * 60)
    
    for i, scenario in enumerate(HEROINE_SCENARIOS, 1):
        # 임베딩 생성 (content + keywords 결합)
        keywords_text = " ".join(scenario["metadata"]["keywords"])
        embedding_text = f"{scenario['content']}\n\n키워드: {keywords_text}"
        embedding = embeddings.embed_query(embedding_text)
        
        sql = text("""
            INSERT INTO heroine_scenarios (heroine_id, memory_progress, title, content, metadata, content_embedding)
            VALUES (:heroine_id, :memory_progress, :title, :content, :metadata, :embedding)
            ON CONFLICT DO NOTHING
        """)
        
        with engine.connect() as conn:
            conn.execute(sql, {
                "heroine_id": scenario["heroine_id"],
                "memory_progress": scenario["memory_progress"],
                "title": scenario["title"],
                "content": scenario["content"],
                "metadata": json.dumps(scenario["metadata"], ensure_ascii=False),
                "embedding": str(embedding)
            })
            conn.commit()
        
        print(f"  [{i}/{len(HEROINE_SCENARIOS)}] {scenario['title']}")
        print(f"      keywords: {len(scenario['metadata']['keywords'])}개")
    
    print(f"\n히로인 시나리오 삽입 완료! 총 {len(HEROINE_SCENARIOS)}개")


def seed_sage_scenarios():
    """대현자 시나리오 삽입 (metadata 포함)"""
    engine = create_engine(CONNECTION_URL)
    embeddings = OpenAIEmbeddings(model="text-embedding-3-small")
    
    print("\n" + "=" * 60)
    print("대현자 시나리오 삽입 시작...")
    print("=" * 60)
    
    for i, scenario in enumerate(SAGE_SCENARIOS, 1):
        # 임베딩 생성 (content + keywords 결합)
        keywords_text = " ".join(scenario["metadata"]["keywords"])
        embedding_text = f"{scenario['content']}\n\n키워드: {keywords_text}"
        embedding = embeddings.embed_query(embedding_text)
        
        sql = text("""
            INSERT INTO sage_scenarios (scenario_level, title, content, metadata, content_embedding)
            VALUES (:scenario_level, :title, :content, :metadata, :embedding)
            ON CONFLICT DO NOTHING
        """)
        
        with engine.connect() as conn:
            conn.execute(sql, {
                "scenario_level": scenario["scenario_level"],
                "title": scenario["title"],
                "content": scenario["content"],
                "metadata": json.dumps(scenario["metadata"], ensure_ascii=False),
                "embedding": str(embedding)
            })
            conn.commit()
        
        print(f"  [{i}/{len(SAGE_SCENARIOS)}] {scenario['title']}")
        print(f"      keywords: {len(scenario['metadata']['keywords'])}개")
    
    print(f"\n대현자 시나리오 삽입 완료! 총 {len(SAGE_SCENARIOS)}개")


if __name__ == "__main__":
    print("\n" + "=" * 60)
    print("        시나리오 데이터 시딩 시작 (metadata 포함)")
    print("=" * 60 + "\n")
    
    seed_heroine_scenarios()
    seed_sage_scenarios()
    
    print("\n" + "=" * 60)
    print("        모든 시딩 완료!")
    print("=" * 60)
    print("\n삽입된 데이터:")
    print(f"  - 히로인 시나리오: {len(HEROINE_SCENARIOS)}개")
    print("    - 레티아: 6개 (memory_progress 10, 50, 60, 70, 80, 100)")
    print("    - 루파메스: 6개 (memory_progress 10, 50, 60, 70, 80, 100)")
    print("    - 로코: 6개 (memory_progress 10, 50, 60, 70, 80, 100)")
    print(f"  - 대현자 시나리오: {len(SAGE_SCENARIOS)}개")
    print("    - scenario_level 1~10")
    print("\n✅ 각 시나리오에 검색 최적화용 keywords가 포함되어 있습니다.")
    print("✅ 임베딩은 content + keywords를 결합하여 생성됩니다.\n")